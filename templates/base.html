<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Project Management Tool{% endblock %}</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- Smooth UI + Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: url('https://images.unsplash.com/photo-1556761175-4b46a572b786?auto=format&fit=crop&w=1920&q=80')
                  no-repeat center center fixed;
      background-size: cover;
      padding-top: 80px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(6px);
      z-index: 0;
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(-45deg,
        rgba(66,165,245,0.18),
        rgba(156,39,176,0.18),
        rgba(38,198,218,0.18),
        rgba(255,193,7,0.18)
      );
      background-size: 400% 400%;
      animation: gradientShift 18s ease infinite;
      z-index: 1;
      pointer-events: none;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .navbar {
      background: linear-gradient(90deg, rgba(66,165,245,0.90), rgba(38,198,218,0.90));
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      z-index: 1002;
    }

    footer {
      background: rgba(0,0,0,0.7);
      color: #ccc;
      text-align: center;
      padding: 15px;
      margin-top: 40px;
    }

main.container {
    position: relative;
    z-index: 1003; /* above overlays */
}

.card, .table, .project-card {
    position: relative;
    z-index: 1003;
}

  </style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow-lg">
  <div class="container">

    <a class="navbar-brand d-flex align-items-center"
       href="{% url 'dashboard:global_dashboard' %}">
      <i class="bi bi-kanban-fill me-2 fs-4"></i> PMS
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-center">

        {% if user.is_authenticated %}

          <!-- NOTIFICATION -->
          <li class="nav-item dropdown me-3">
            <a class="nav-link position-relative" id="notifDropdown" data-bs-toggle="dropdown">
              <i class="bi bi-bell-fill fs-5"></i>
              <span id="notif-badge" class="badge bg-danger position-absolute top-0 start-100 translate-middle"
                    style="display:none;"></span>
            </a>

            <ul class="dropdown-menu dropdown-menu-end shadow-lg p-2" style="width:320px;">
              <li class="dropdown-header fw-bold text-center">Notifications</li>
              <hr>
              <div id="notif-list">
                <p class="dropdown-item text-muted text-center">Loading...</p>
              </div>
              <hr>
              <li><a class="dropdown-item small text-primary text-center"
                     href="{% url 'notifications:list' %}">
                View All ‚Üí
              </a></li>
            </ul>
          </li>

          <!-- LINKS -->
          <li class="nav-item"><a class="nav-link" href="{% url 'projects:project_list' %}">Projects</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'tasks:task_list' %}">Modules</a></li>
          <li class="nav-item">
  <a class="nav-link" href="{% url 'dashboard:global_dashboard' %}">
      <i class="bi bi-graph-up-arrow me-1"></i> Overview
  </a>
</li>


          <!-- ROLE SELECT DROPDOWN -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="roleDropdown" role="button"
               data-bs-toggle="dropdown">üë§ Role</a>

            <ul class="dropdown-menu dropdown-menu-end shadow">
              <li><a class="dropdown-item" href="{% url 'dashboard:global_dashboard' %}">üåç Global Dashboard</a></li>

              {% if user.role == "HR" %}
                <li><a class="dropdown-item" href="{% url 'dashboard:hr_dashboard' %}">üßë‚Äçüíº HR Dashboard</a></li>
              {% endif %}

              {% if user.role == "Manager" %}
                <li><a class="dropdown-item" href="{% url 'dashboard:dashboard' %}">üìä Manager Dashboard</a></li>
              {% endif %}

              {% if user.role == "Team Member" %}
                <li><a class="dropdown-item" href="{% url 'dashboard:dashboard' %}">üë®‚Äçüíª My Dashboard</a></li>
              {% endif %}

              <li><a class="dropdown-item text-primary fw-bold"
                     href="{% url 'dashboard:select_role' %}">
                    ‚ûï Choose Another Role
                  </a></li>
            </ul>
          </li>

          <!-- LOGOUT -->
          <li class="nav-item"><a class="nav-link" href="/user/logout/">Logout</a></li>

        {% else %}
          <li class="nav-item"><a class="nav-link" href="/user/login/">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="/user/register/">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>


<div class="position-fixed top-0 end-0 p-3" style="z-index:9999;">
  <div id="toastContainer"></div>
</div>

<main class="container py-4">
  {% block content %}{% endblock %}
</main>

<footer>
  <strong>Vetri IT Systems</strong> ¬© 2025 Productivity PMS
</footer>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
{% if user.is_authenticated %}
const badge = document.getElementById("notif-badge");
const list = document.getElementById("notif-list");

function loadNotifications(){
  fetch("/notifications/unread/")
  .then(res=>res.json())
  .then(data=>{
    badge.style.display = data.count ? "inline-block" : "none";
    badge.innerText = data.count;

    list.innerHTML = "";
    if(data.items.length===0){
      list.innerHTML = `<p class="dropdown-item text-muted text-center small">
        No new notifications
      </p>`;
      return;
    }
    data.items.forEach(n=>{
      list.innerHTML += `<li><a class="dropdown-item small">
        ${n.message}<br>
        <small class="text-muted">${n.created_at}</small>
      </a></li>`;
    })
  });
}

loadNotifications();
{% endif %}
</script>

</body>
</html>
