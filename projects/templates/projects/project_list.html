{% extends 'base.html' %}
{% block title %}üåü My Projects{% endblock %}

{% block content %}
<style>
  @keyframes fadeInUp { from { opacity:0; transform:translateY(25px);} to { opacity:1; transform:translateY(0);} }

  .projects-container { animation:fadeInUp 1s; margin-top:90px; }

  .page-header { text-align:center; color:white; font-weight:700; margin-bottom:1rem; }

  .filter-box {
    background:white; padding:15px; border-radius:12px;
    box-shadow:0 3px 15px rgba(0,0,0,0.15);
    margin-bottom:25px;
  }

  .project-card {
    background:rgba(255,255,255,0.9); border-radius:15px; padding:1.3rem;
    margin-bottom:1rem; box-shadow:0 4px 15px rgba(0,0,0,0.1); transition:0.3s;
  }
  .project-card:hover { transform:translateY(-6px); box-shadow:0 10px 25px rgba(33,150,243,0.4); }

  .deadline-alert { color:red; font-weight:700; }
  .deadline-soon { color:#e65100; font-weight:700; }

</style>

<div class="projects-container container">

  <h2 class="page-header">Your Projects</h2>

  <!-- üîç SEARCH + FILTER + SORT -->
  <div class="filter-box">
    <form method="GET" class="row g-2">

      <div class="col-md-3">
        <input type="text" name="q" placeholder="Search‚Ä¶" value="{{ request.GET.q }}" class="form-control">
      </div>

      <div class="col-md-2">
        <select name="priority" class="form-control">
          <option value="">Priority</option>
          <option value="High" {% if request.GET.priority == "High" %}selected{% endif %}>High</option>
          <option value="Medium" {% if request.GET.priority == "Medium" %}selected{% endif %}>Medium</option>
          <option value="Low" {% if request.GET.priority == "Low" %}selected{% endif %}>Low</option>
        </select>
      </div>

      <div class="col-md-2">
        <select name="status" class="form-control">
          <option value="">Status</option>
          <option value="Pending" {% if request.GET.status == "Pending" %}selected{% endif %}>Pending</option>
          <option value="In Progress" {% if request.GET.status == "In Progress" %}selected{% endif %}>In Progress</option>
          <option value="Completed" {% if request.GET.status == "Completed" %}selected{% endif %}>Completed</option>
        </select>
      </div>

      <div class="col-md-3">
        <select name="sort" class="form-control">
          <option value="">Sort By</option>
          <option value="name" {% if request.GET.sort == "name" %}selected{% endif %}>Name (A‚ÄìZ)</option>
          <option value="-name" {% if request.GET.sort == "-name" %}selected{% endif %}>Name (Z‚ÄìA)</option>
          <option value="priority" {% if request.GET.sort == "priority" %}selected{% endif %}>Priority</option>
          <option value="-assigned_date" {% if request.GET.sort == "-assigned_date" %}selected{% endif %}>Latest Assigned</option>
        </select>
      </div>

      <div class="col-md-2">
        <button class="btn btn-primary w-100"><i class="bi bi-search"></i> Apply</button>
      </div>

    </form>
  </div>

  <!-- PROJECT LIST -->
  {% if projects %}
    {% for project in projects %}
      <a href="{% if readonly %}{% url 'projects:project_detail_readonly' project.id %}{% else %}{% url 'projects:project_detail' project.id %}{% endif %}"
         class="text-decoration-none text-dark">

        <div class="project-card">

          <h5 class="fw-bold text-primary">{{ project.name }}</h5>
          <p class="text-muted">{{ project.description|truncatechars:120 }}</p>

          <!-- Deadline Alerts -->
          {% if project.delivery_date %}
            {% now "U" as nowTs %}
            {% with due=project.delivery_date|date:"U" %}
              {% if due < nowTs %}
                <div class="deadline-alert">‚ö†Ô∏è Overdue!</div>
              {% elif due < nowTs|add:"172800" %}
                <div class="deadline-soon">‚è≥ Due Soon</div>
              {% endif %}
            {% endwith %}
          {% endif %}

        </div>
      </a>
    {% endfor %}
  {% else %}
    <div class="alert alert-warning text-center">No Projects Found</div>
  {% endif %}

</div>
{% endblock %}
